<!DOCTYPE html>
<html lang="pt">


<!-- index.html  21 Nov 2019 03:44:50 GMT -->

<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, shrink-to-fit=no" name="viewport">
    <title>Tempus</title>
    <!-- General CSS Files -->
    <link rel="stylesheet" href="/assets/css/app.min.css">
    <!-- Template CSS -->
    <link rel="stylesheet" href="/assets/css/style.css">
    <link rel="stylesheet" href="/assets/css/components.css">
    <!-- Custom style CSS -->
    <link rel="stylesheet" href="/assets/css/custom.css">
    <link rel='shortcut icon' type='image/png' href='/assets/img/AddedSolutions.jpg' />
</head>

<body>

    <div id="app">
        <div class="main-wrapper main-wrapper-1">
            <div class="navbar-bg"></div>
            <nav class="navbar navbar-expand-lg main-navbar sticky">
                <div class="form-inline mr-auto">
                    <ul class="navbar-nav mr-3">
                        <li>
                            <a href="#" data-toggle="sidebar" class="nav-link nav-link-lg
									collapse-btn"> <i data-feather="align-justify"></i></a>
                        </li>
                        <li>
                            <a href="#" class="nav-link nav-link-lg fullscreen-btn">
                                <i data-feather="maximize"></i>

                            </a>
                        </li>

                        <li>
                            <a class="nav-link nav-link-lg font-18">
                            <img src="<%= user.intituicao_responsavel.logo.url %>" style="width: 100%;height: 40px;"  alt="" srcset="">


                            </a>
                        </li>
                        <li>
                            <a class="nav-link nav-link-lg font-18">

                                <%= user.intituicao_responsavel.nome %>

                            </a>
                        </li>

                    </ul>
                </div>
                <ul class="navbar-nav navbar-right">
                    <li class="dropdown"><a href="#" data-toggle="dropdown" class="nav-link dropdown-toggle nav-link-lg nav-link-user"> <img alt="image" <img alt="image" src="<%= user.foto?user.foto[0].url:'/assets/img/logo.png' %> "
                class="user-img-radious-style"> <span class="d-sm-none d-lg-inline-block"></span></a>
                        <div class="dropdown-menu dropdown-menu-right pullDown">
                            <div class="dropdown-title">Olá
                                <%= user.username %>
                            </div>
                            <a href="/instituicao/perfil" class="dropdown-item has-icon"> <i class="far
										fa-user"></i> Perfil
                            </a>
                            <div class="dropdown-divider"></div>
                            <a href="/api/auth/logout" class="dropdown-item has-icon text-danger"> <i class="fas fa-sign-out-alt"></i> Sair
                            </a>
                        </div>
                    </li>
                </ul>
            </nav>
            <div class="main-sidebar sidebar-style-2">
                <aside id="sidebar-wrapper">
                    <div class="sidebar-brand">
                        <a href="/"> <img alt="image" src="/assets/img/AddedSolutions.jpg" class="header-logo" /> <span class="logo-name" style="color: blue; font-size: 12pt;">Tempus</span>
                        </a>
                    </div>
                    <ul class="sidebar-menu">
                        <li class="menu-header"></li>
                        <li class="dropdown active">
                            <a href="/instituicao" class="nav-link"><i data-feather="monitor"></i><span>PAINEL DE CONTROLO</span></a>
                        </li>
                        <li class="dropdown">
                            <a href="#" class="menu-toggle nav-link has-dropdown"><i data-feather="users"></i><span>ACOMPANHAMENTO </span></a>
                            <ul class="dropdown-menu">
                                <li><a class="nav-link" href="/instituicao/alertas">ALERTAS</a></li>
                                <li><a class="nav-link" href="/instituicao/relatorios">RELATÓRIOS</a></li>
                                <li><a class="nav-link" href="/instituicao/live">MONITORIZAÇÃO</a></li>
                            </ul>
                        </li>
                        <li class="dropdown">
                            <a href="#" class="menu-toggle nav-link has-dropdown">
                                <i data-feather="file-text"></i><span>INSTITUIÇÃO</span></a>
                            <ul class="dropdown-menu">
                                <li><a class="nav-link" href="/instituicao/tecnicos">TÉCNICOS</a></li>
                                <li><a class="nav-link" href="/instituicao/utentes">UTENTES</a></li>
                                <li><a class="nav-link" href="/instituicao/perfil">PERFIL DA INSTITUIÇÃO</a></li>
                                <li><a class="nav-link" href="/instituicao/arquivos">ARQUIVO</a></li>
                            </ul>


                        </li>



                    </ul>
                </aside>
            </div>
            <!-- Main Content -->
            <div class="main-content" style="margin-top: -30px;">
                <section class="section">
                    <div class="row ">

                        <a href="/instituicao/utentes" class="col" style="text-decoration: none;">
                            <div class="card">
                                <div class="card-statistic-4">
                                    <div class="align-items-center justify-content-between">
                                        <div class="row ">
                                            <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6 pr-0 pt-3">
                                                <div class="card-content">
                                                    <h5 class="font-14">Utentes</h5>
                                                    <h2 class="mb-3 font-18">
                                                        <%= user.intituicao_responsavel.utentes.length %>
                                                    </h2>

                                                </div>
                                            </div>
                                            <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6 pl-0">
                                                <div class="banner-img">
                                                    <i data-feather="users" style="width: 90px;height: 90px; color: rgb(24, 49, 192);"></i>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </a>

                        <a href="/instituicao/tecnicos" class="col" style="text-decoration: none;">
                            <div class="card">
                                <div class="card-statistic-4">
                                    <div class="align-items-center justify-content-between">
                                        <div class="row ">
                                            <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6 pr-0 pt-3">
                                                <div class="card-content">
                                                    <h5 class="font-14">Técnicos</h5>

                                                    <h2 class="mb-3 font-18">
                                                        <%= user.intituicao_responsavel.tecnicos.length %>
                                                    </h2>
                                                </div>
                                            </div>
                                            <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6 pl-0">
                                                <div class="banner-img">
                                                    <i data-feather="user" style="width: 90px;height: 90px; color: rgb(24, 49, 192);"></i>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </a>

                        <a href="/instituicao/relatorios" class="col" style="text-decoration: none;">
                            <div class="card">
                                <div class="card-statistic-4">
                                    <div class="align-items-center justify-content-between">
                                        <div class="row ">
                                            <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6 pr-0 pt-3">
                                                <div class="card-content">
                                                    <h5 class="font-14">Taxa de acerto global</h5>
                                                    <h2 class="mb-3 font-18">
                                                        <%= desempenho.toFixed(0) %> %
                                                    </h2>

                                                </div>
                                            </div>
                                            <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6 pl-0">
                                                <div class="banner-img">
                                                    <i data-feather="layers" style="width: 90px;height: 90px; color: rgb(24, 49, 192);"></i>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </a>

                        <a href="/instituicao/relatorios" class="col" style="text-decoration: none;">
                            <div class="card">
                                <div class="card-statistic-4">
                                    <div class="align-items-center justify-content-between">
                                        <div class="row ">
                                            <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6 pr-0 pt-3">
                                                <div class="card-content">
                                                    <h5 class="font-14">Tempo</h5>
                                                    <h2 class="mb-3 font-18">
                                                        <%= tempo %> min
                                                    </h2>

                                                </div>
                                            </div>
                                            <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6 pl-0">
                                                <div class="banner-img">
                                                    <i data-feather="watch" style="width: 90px;height: 90px; color: rgb(24, 49, 192);"></i>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </a>
                    </div>
                    <div class="row">
                        <div class="col-12 col-sm-12 col-lg-12">
                            <div class="card ">
                                <div class="card-header" style="display: flex;justify-content: space-between;align-items: center;">
                                    <h4 id="titulo">Tempo de Utilização (min)
                                    </h4>

                                    <div class="dropdown mr-2">
                                        <a href="#" data-toggle="dropdown" class="btn btn-primary dropdown-toggle">Observar</a>
                                        <div class="dropdown-menu">
                                            <a href="#" onclick="t()" class="dropdown-item has-icon"> <i data-feather="watch"></i>Tempo</a>
                                            <a href="#" onclick="d()" class="dropdown-item has-icon"><i  data-feather="layers"></i>Taxa de acerto</a>



                                        </div>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-lg-12">
                                            <div id="chartdiv"></div>


                                        </div>

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>


                </section>

            </div>

        </div>
    </div>
    <!-- General JS Scripts -->
    <script src="/assets/js/app.min.js"></script>
    <!-- JS Libraies -->


    <!-- Template JS File -->
    <script src="/assets/js/scripts.js"></script>
    <!-- Custom JS File -->
    <script src="/assets/js/custom.js"></script>



    <script src="https://cdn.amcharts.com/lib/5/index.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/xy.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/themes/Animated.js"></script>

    <!-- Chart code -->
    <script>
        let xAxis;
        let series;
        let chart;

        let yRenderer;
        let yAxis;
        let user = '<%-JSON.stringify(user)  %>'
        user = JSON.parse(user)
        console.log(user)

        console.log(am5xy)

        let root;

        function t() {

            let data = []

            //Teste
            user.intituicao_responsavel.utentes.map(utente => {


                data.push({
                    // Set data
                    name: utente.nome,
                    value: Number(utente.f.split(',')[12]),
                    bulletSettings: {
                        src: utente.img ? utente.img[0].url : "/assets/img/logo.png"
                    }
                })
                console.log(utente)

            })
            xAxis.data.setAll(data);
            series.data.setAll(data);






            document.getElementById('titulo').innerHTML = "Tempo de Utilização (min)"

        }

        function d() {
            let data = []

            //Teste
            user.intituicao_responsavel.utentes.map(utente => {


                data.push({
                    // Set data
                    name: utente.nome,
                    value: parseFloat(utente.f.split(',')[11]).toFixed(0),
                    bulletSettings: {
                        src: utente.img ? utente.img[0].url : "/assets/img/logo.png"
                    }
                })
                console.log(utente)

            })
            xAxis.data.setAll(data);
            series.data.setAll(data);

            document.getElementById('titulo').innerHTML = "Taxa de acerto (%)"





        }


        function tempo() {
            // Create root element
            // https://www.amcharts.com/docs/v5/getting-started/#Root_element
            let root = am5.Root.new("chartdiv");

            // Set themes
            // https://www.amcharts.com/docs/v5/concepts/themes/
            root.setThemes([
                am5themes_Animated.new(root)
            ]);

            // Create chart
            // https://www.amcharts.com/docs/v5/charts/xy-chart/
            chart = root.container.children.push(am5xy.XYChart.new(root, {
                panX: false,
                panY: false,
                wheelX: "none",
                wheelY: "none"
            }));

            // Add cursor
            // https://www.amcharts.com/docs/v5/charts/xy-chart/cursor/
            let cursor = chart.set("cursor", am5xy.XYCursor.new(root, {}));
            cursor.lineY.set("visible", false);

            // Create axes
            // https://www.amcharts.com/docs/v5/charts/xy-chart/axes/
            let xRenderer = am5xy.AxisRendererX.new(root, {
                minGridDistance: 30
            });

            xAxis = chart.xAxes.push(am5xy.CategoryAxis.new(root, {
                maxDeviation: 0,
                categoryField: "name",
                renderer: xRenderer,
                tooltip: am5.Tooltip.new(root, {})
            }));

            xRenderer.grid.template.set("visible", false);

            yRenderer = am5xy.AxisRendererY.new(root, {});
            yAxis = chart.yAxes.push(am5xy.ValueAxis.new(root, {
                maxDeviation: 0,
                min: 0,
                max: 80,
                extraMax: 0.1,
                renderer: yRenderer
            }));

            yRenderer.grid.template.setAll({
                strokeDasharray: [2, 2]
            });

            // Create series
            // https://www.amcharts.com/docs/v5/charts/xy-chart/series/
            series = chart.series.push(am5xy.ColumnSeries.new(root, {
                name: "Series 1",
                xAxis: xAxis,
                yAxis: yAxis,
                valueYField: "value",
                sequencedInterpolation: true,
                categoryXField: "name",
                tooltip: am5.Tooltip.new(root, {
                    dy: -25,
                    labelText: "{valueY}"
                })
            }));


            series.columns.template.setAll({
                cornerRadiusTL: 5,
                cornerRadiusTR: 5
            });

            series.columns.template.adapters.add("fill", (fill, target) => {
                return chart.get("colors").getIndex(series.columns.indexOf(target));
            });

            series.columns.template.adapters.add("stroke", (stroke, target) => {
                return chart.get("colors").getIndex(series.columns.indexOf(target));
            });

            let data = []

            //Teste
            user.intituicao_responsavel.utentes.map(utente => {


                data.push({
                    // Set data
                    name: utente.nome,
                    value: Number(utente.f1.split(',')[3]) +
                        Number(utente.f2.split(',')[3]) +
                        Number(utente.f3.split(',')[3]) +
                        Number(utente.f4.split(',')[3]) +
                        Number(utente.f5.split(',')[3]) +
                        Number(utente.f6.split(',')[3]) +
                        Number(utente.f7.split(',')[3]) +
                        Number(utente.f8.split(',')[3]) +
                        Number(utente.f9.split(',')[3]) +
                        Number(utente.f10.split(',')[3]) +
                        Number(utente.f11.split(',')[3])


                    ,
                    bulletSettings: {
                        src: utente.img ? utente.img[0].url : "/assets/img/logo.png"
                    }
                })
                console.log(utente)

            })

            series.bullets.push(function() {
                return am5.Bullet.new(root, {
                    locationY: 1,
                    sprite: am5.Picture.new(root, {
                        templateField: "bulletSettings",
                        width: 50,
                        height: 50,
                        centerX: am5.p50,
                        centerY: am5.p50,
                        shadowColor: am5.color(0x000000),
                        shadowBlur: 4,
                        shadowOffsetX: 4,
                        shadowOffsetY: 4,
                        shadowOpacity: 0.6
                    })
                });
            });

            xAxis.data.setAll(data);
            series.data.setAll(data);

            // Make stuff animate on load
            // https://www.amcharts.com/docs/v5/concepts/animations/
            series.appear(100);
            chart.appear(100, 0);

        }

        am5.ready(function() {

            tempo()
                // desempenho()
        }); // end am5.ready()
    </script>


</body>



</html>